{% extends "base.html" %}

{% block title %}Modifier l'Étudiant{% endblock %}

{% block content %}
<div class="main-content">
    <div class="container-fluid py-4">
        <!-- Header de la page -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="mb-1"><i class="bi bi-person-gear text-primary"></i> Modifier un Étudiant</h1>
                        <p class="text-muted mb-0">Modifiez les informations de l'étudiant</p>
                    </div>
                    <div>
                        <a href="{{ url_for('etudiant.etudiant') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Retour à la liste
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Formulaire de modification -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-person-gear"></i> Modifier les informations de l'étudiant</h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Info étudiant en cours de modification -->
                       

                        <form id="editStudentForm" enctype="multipart/form-data" method="POST" action="{{ url_for('etudiant.modifier_etud', id=etudiant.id_etudiant) }}">
                            <!-- Photo de profil -->
                            <div class="row mb-4">
                                <div class="col-12 text-center">
                                    <div class="profile-photo-container">
                                        <div class="profile-photo-wrapper">
                                            {% if etudiant.Photo %}
                                                <img id="previewPhoto" src="{{ url_for('static', filename='uploads/' + etudiant.Photo) }}" 
                                                     alt="Photo de profil" class="profile-photo">
                                            {% else %}
                                                <img id="previewPhoto" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiByeD0iNjAiIGZpbGw9IiNFOUVDRUYiLz4KPHN2ZyB4PSIzMCIgeT0iMjUiIHdpZHRoPSI2MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjQkNDMEQ0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K" 
                                                     alt="Photo de profil par défaut" class="profile-photo">
                                            {% endif %}
                                            <div class="photo-overlay">
                                                <i class="bi bi-camera"></i>
                                            </div>
                                        </div>
                                        <input type="file" id="Photo" name="Photo" accept="image/*" class="d-none">
                                        <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="document.getElementById('Photo').click()">
                                            <i class="bi bi-upload"></i> Changer la photo
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Informations personnelles -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="prenom" class="form-label">
                                        <i class="bi bi-person"></i> Prénom <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="prenom" name="prenom" value="{{ etudiant.prenom }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nom" class="form-label">
                                        <i class="bi bi-person"></i> Nom <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="nom" name="nom" value="{{ etudiant.nom }}" required>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="Email" class="form-label">
                                        <i class="bi bi-envelope"></i> Email <span class="text-danger">*</span>
                                    </label>
                                    <input type="email" class="form-control" id="Email" name="Email" value="{{ etudiant.Email }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">
                                        <i class="bi bi-telephone"></i> Téléphone
                                    </label>
                                    <input type="tel" class="form-control" id="telephone" name="telephone" value="{{ etudiant.telephone }}">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="birth_date" class="form-label">
                                        <i class="bi bi-calendar"></i> Date de naissance
                                    </label>
                                    <input type="date" class="form-control" id="date_naissance" name="date_naissance" value="{{ etudiant.date_naissance }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="class" class="form-label">
                                        <i class="bi bi-book"></i> Classe <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="class" name="class" required>
                                        <option value="">Sélectionner une classe</option>
                                        <option value="GI1" {% if etudiant.class_ == 'GI1' %}selected{% endif %}>GI1</option>
                                        <option value="GI2" {% if etudiant.class_ == 'GI2' %}selected{% endif %}>GI2</option>
                                        <option value="GI3" {% if etudiant.class_ == 'GI3' %}selected{% endif %}>GI3</option>
                                        <option value="GI4" {% if etudiant.class_ == 'GI4' %}selected{% endif %}>GI4</option>
                                        <option value="GI5" {% if etudiant.class_ == 'GI5' %}selected{% endif %}>GI5</option>
                                        <option value="GAE1" {% if etudiant.class_ == 'GAE1' %}selected{% endif %}>GAE1</option>
                                        <option value="GAE2" {% if etudiant.class_ == 'GAE2' %}selected{% endif %}>GAE2</option>
                                        <option value="GAE3" {% if etudiant.class_ == 'GAE3' %}selected{% endif %}>GAE3</option>
                                        <option value="GAE4" {% if etudiant.class_ == 'GAE4' %}selected{% endif %}>GAE4</option>
                                        <option value="GAE5" {% if etudiant.class_ == 'GAE5' %}selected{% endif %}>GAE5</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Ajout des nouveaux champs -->
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="annee_universitaire" class="form-label">Année universitaire</label>
                                    <select class="form-select" id="annee_universitaire" name="annee_universitaire">
                                        <option value="">Sélectionner</option>
                                        <option value="2023-2024" {% if etudiant.annee_universitaire == '2023-2024' %}selected{% endif %}>2023-2024</option>
                                        <option value="2024-2025" {% if etudiant.annee_universitaire == '2024-2025' %}selected{% endif %}>2024-2025</option>
                                        <option value="2025-2026" {% if etudiant.annee_universitaire == '2025-2026' %}selected{% endif %}>2025-2026</option>
                                    </select>
                                  </div>
                                <div class="col-md-4 mb-3">
                                    <label for="genre" class="form-label">
                                        <i class="bi bi-gender-ambiguous"></i> Genre
                                    </label>
                                    <select class="form-select" id="genre" name="genre">
                                        <option value="">Sélectionner le genre</option>
                                        <option value="Masculin" {% if etudiant.genre == 'Masculin' %}selected{% endif %}>Masculin</option>
                                        <option value="Feminin" {% if etudiant.genre == 'Feminin' %}selected{% endif %}>Feminin</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="date_inscription" class="form-label">
                                        <i class="bi bi-calendar-check"></i> Date d'inscription
                                    </label>
                                    <input type="date" class="form-control" id="date_inscription" name="date_inscription" value="{{ etudiant.date_inscription }}">
                                </div>
                            </div>

                            <!-- Adresse -->
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="address" class="form-label">
                                        <i class="bi bi-house"></i> Adresse
                                    </label>
                                    <textarea class="form-control" id="address" name="address" rows="2" placeholder="Numéro, rue, ville, code postal...">{{ etudiant.address }}</textarea>
                                </div>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between">
                                        <button type="button" class="btn btn-outline-secondary" onclick="history.back()">
                                            <i class="bi bi-x-circle"></i> Annuler
                                        </button>
                                        <div>
                                           
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-check-circle"></i> Enregistrer les modifications
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Prévisualisation de la photo
    document.getElementById('Photo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('previewPhoto').src = event.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    // Gestion du formulaire
    // document.getElementById('editStudentForm').addEventListener('submit', function(e) {
    //     e.preventDefault();
        
    //     // Validation basique
    //     const requiredFields = ['prenom', 'nom', 'email', 'class'];
    //     let isValid = true;
        
    //     requiredFields.forEach(field => {
    //         const element = document.getElementById(field);
    //         if (!element.value.trim()) {
    //             element.classList.add('is-invalid');
    //             isValid = false;
    //         } else {
    //             element.classList.remove('is-invalid');
    //         }
    //     });
        
    //     if (!isValid) {
    //         alert('Veuillez remplir tous les champs obligatoires.');
    //         return;
    //     }
        
    //     // Confirmation avant modification
    //     if (!confirm('Êtes-vous sûr de vouloir enregistrer les modifications ?')) {
    //         return;
    //     }
        
    //     // Soumission du formulaire
    //     const formData = new FormData(this);
        
    //     fetch('/api/students/1', {
    //         method: 'PUT',
    //         body: formData
    //     })
    //     .then(response => {
    //         if (response.ok) {
    //             alert('Étudiant modifié avec succès !');
    //             window.location.href = "{{ url_for('etudiant.etudiant') }}";
    //         } else {
    //             alert('Erreur lors de la modification de l\'étudiant.');
    //         }
    //     })
    //     .catch(error => {
    //         console.error('Erreur:', error);
    //         alert('Erreur lors de la modification de l\'étudiant.');
    //     });
    // });

    // // Confirmation avant réinitialisation
    // document.querySelector('button[type="reset"]').addEventListener('click', function(e) {
    //     if (!confirm('Êtes-vous sûr de vouloir réinitialiser le formulaire ? Toutes les modifications seront perdues.')) {
    //         e.preventDefault();
    //     }
    // });
</script>

<style>
    .profile-photo-container {
        text-align: center;
    }
    
    .profile-photo-wrapper {
        position: relative;
        display: inline-block;
    }
    
    .profile-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #e9ecef;
    }
    
    .photo-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .profile-photo-wrapper:hover .photo-overlay {
        opacity: 1;
    }
</style>

{% endblock %}
