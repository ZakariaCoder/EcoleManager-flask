<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard/index.css') }}">
{% extends "base.html" %}
{% block content %}

<div class="main-content">
    <!-- Top Navbar -->
    <div class="top-navbar">
        <div>
            <button class="btn btn-outline-primary d-md-none" id="sidebarToggle">
                <i class="bi bi-list"></i>
            </button>
            <h4 class="mb-0">Tableau de bord</h4>
        </div>

        <div class="user-profile">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiByeD0iNjAiIGZpbGw9IiNFOUVDRUYiLz4KPHN2ZyB4PSIzMCIgeT0iMjUiIHdpZHRoPSI2MCIgaGVpZ2h0PSI3MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjQkNDMEQ0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K">
            <span>{{ current_user.username }}</span>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row">
        <div class="col-md-3">
            <div class="dashboard-card">
                <div class="card-icon blue">
                    <i class="bi bi-people"></i>
                </div>
                <h5>Étudiants</h5>
                <h2 class="text-primary">{{ stats.total_etudiants }}</h2>
                <p class="text-muted mb-0">
                    {% if stats.etudiants_change > 0 %}
                        +{{ stats.etudiants_change }}% ce mois
                    {% else %}
                        {{ stats.etudiants_change }}% ce mois
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-card">
                <div class="card-icon green">
                    <i class="bi bi-person-video3"></i>
                </div>
                <h5>Professeurs</h5>
                <h2 class="text-success">{{ stats.total_professeurs }}</h2>
                <p class="text-muted mb-0">
                    {% if stats.professeurs_change > 0 %}
                        +{{ stats.professeurs_change }}% ce mois
                    {% else %}
                        {{ stats.professeurs_change }}% ce mois
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-card">
                <div class="card-icon orange">
                    <i class="bi bi-book"></i>
                </div>
                <h5>Classes</h5>
                <h2 class="text-warning">{{ stats.total_classes }}</h2>
                <p class="text-muted mb-0">{{ stats.nouvelles_classes }} nouvelles</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dashboard-card">
                <div class="card-icon pink">
                    <i class="bi bi-journal-text"></i>
                </div>
                <h5>Notes</h5>
                <h2 class="text-danger">{{ stats.total_notes }}</h2>
                <p class="text-muted mb-0">{{ stats.nouvelles_notes }} nouvelles</p>
            </div>
        </div>
    </div>

    <!-- Recent Students -->
    <div class="row">
        <div class="col-md-8">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5>Derniers étudiants inscrits</h5>
                    <a href="{{ url_for('etudiant.etudiant') }}" class="btn btn-sm btn-outline-primary">Voir tout</a>
                </div>

                <div class="table-responsive student-table">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Inscription</th>
                                <th>Classe</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for etudiant in derniers_etudiants %}
                            <tr>
                                <td>#{{ etudiant.id_etudiant }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        {% if etudiant.Photo %}
                                        <img src="{{ url_for('static', filename='uploads/' + etudiant.Photo) }}" class="rounded-circle" width="40" height="40" alt="Photo">
                                    {% else %}
                                        <img src="{{ url_for('static', filename='img/student-avatar.jpg') }}" class="rounded-circle" width="40" height="40" alt="Photo">
                                    {% endif %}
                                        {{ etudiant.prenom }} {{ etudiant.nom }}
                                    </div>
                                </td>
                                <td>{{ etudiant.Email }}</td>
                                <td>{{ etudiant.date_inscription.strftime('%d/%m/%Y') if etudiant.date_inscription else 'N/A' }}</td>
                                <td>{{ etudiant.class_ or 'N/A' }}</td>
                                <td>
                                    <a href="{{ url_for('etudiant.afficher_etud', id=etudiant.id_etudiant) }}" 
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-md-4">
            <div class="dashboard-card">
                <h5 class="mb-4">Derniers professeurs</h5>

                <div class="activity-list">
                    {% for professeur in derniers_professeurs %}
                    <div class="activity-item d-flex mb-3">
                        <div class="activity-icon me-3 text-primary">
                            <i class="bi bi-person-video3"></i>
                        </div>
                        <div>
                            <p class="mb-0">{{ professeur.prenom }} {{ professeur.nom }}</p>
                            <small class="text-muted">
                                {{ professeur.Departement }} - 
                                {{ professeur.Date_embauche.strftime('%d/%m/%Y') if professeur.Date_embauche else 'N/A' }}
                            </small>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Toggle sidebar on mobile
    document.getElementById('sidebarToggle').addEventListener('click', function() {
        document.querySelector('.sidebar').classList.toggle('active');
    });
</script>
{% endblock %}